
import React, { useState } from 'react';
import { useSearchParams, useParams, Link } from 'react-router-dom';
import Layout from '../components/Layout';
import { ArrowLeft, Volume2, Heart, AlertTriangle, CheckCircle } from 'lucide-react';

interface EmergencyStep {
  number: number;
  title: string;
  description: string;
  image?: string;
  warning?: string;
  tip?: string;
}

const EmergencyGuide = () => {
  const [searchParams] = useSearchParams();
  const { situacao } = useParams();
  const [isReading, setIsReading] = useState(false);

  // Get situation from URL params or search params
  const situation = situacao || searchParams.get('situacao');

  const emergencyData: Record<string, {
    title: string;
    emoji: string;
    urgency: 'high' | 'medium' | 'low';
    description: string;
    steps: EmergencyStep[];
    finalTip: string;
  }> = {
    'desmaio': {
      title: 'Pessoa Desmaiada',
      emoji: 'üòµ',
      urgency: 'high',
      description: 'Quando algu√©m perde a consci√™ncia repentinamente',
      steps: [
        {
          number: 1,
          title: 'Verifique a consci√™ncia',
          description: 'Chame a pessoa pelo nome e balance levemente os ombros. Se n√£o responder, est√° inconsciente.',
          warning: 'Nunca balance com for√ßa ou jogue √°gua no rosto!'
        },
        {
          number: 2,
          title: 'Pe√ßa ajuda',
          description: 'Grite por ajuda e pe√ßa para algu√©m chamar o SAMU (192) ou bombeiros (193).',
          tip: 'Se estiver sozinho, use o celular no viva-voz para n√£o deixar a pessoa sozinha.'
        },
        {
          number: 3,
          title: 'Verifique a respira√ß√£o',
          description: 'Observe o peito da pessoa por 10 segundos. Veja se sobe e desce normalmente.',
          warning: 'Se n√£o estiver respirando, inicie a RCP (massagem card√≠aca)!'
        },
        {
          number: 4,
          title: 'Posi√ß√£o lateral de seguran√ßa',
          description: 'Se estiver respirando, vire a pessoa de lado para evitar engasgo caso vomite.',
          tip: 'Dobre o joelho de cima para dar estabilidade.'
        },
        {
          number: 5,
          title: 'Monitore constantemente',
          description: 'Fique ao lado da pessoa at√© a chegada do socorro, verificando sempre a respira√ß√£o.',
          warning: 'Nunca deixe a pessoa sozinha!'
        }
      ],
      finalTip: 'üí° Dica importante: Desmaios podem ter v√°rias causas (calor, press√£o baixa, diabetes). Sempre procure ajuda m√©dica!'
    },
    'engasgo': {
      title: 'Engasgo',
      emoji: 'üö´',
      urgency: 'high',
      description: 'Quando algo bloqueia as vias respirat√≥rias',
      steps: [
        {
          number: 1,
          title: 'Identifique o engasgo',
          description: 'A pessoa leva as m√£os ao pesco√ßo, n√£o consegue falar ou fazer ru√≠do, fica roxa.',
          warning: 'Se ainda consegue tossir, deixe tossir! N√£o interfira.'
        },
        {
          number: 2,
          title: 'Encoraje a tosse',
          description: 'Se a pessoa ainda consegue tossir, encoraje-a a continuar tossindo com for√ßa.',
          tip: 'A tosse √© o mecanismo natural mais eficaz para expelir objetos.'
        },
        {
          number: 3,
          title: 'Manobra de Heimlich',
          description: 'Se n√£o consegue tossir: fique atr√°s da pessoa, abrace pela cintura, punho acima do umbigo, puxe para cima e para dentro.',
          warning: 'Fa√ßa movimentos firmes e r√°pidos!'
        },
        {
          number: 4,
          title: 'Continue at√© desobstruir',
          description: 'Repita a manobra at√© o objeto sair ou a pessoa conseguir respirar novamente.',
          tip: 'Se desmaiar, coloque no ch√£o e inicie RCP.'
        }
      ],
      finalTip: 'üí° Dica: Em beb√™s, vire de bru√ßos no seu antebra√ßo e d√™ 5 tapas nas costas!'
    },
    'crise-ansiedade': {
      title: 'Crise de Ansiedade',
      emoji: 'üò∞',
      urgency: 'medium',
      description: 'Epis√≥dio intenso de medo e sintomas f√≠sicos',
      steps: [
        {
          number: 1,
          title: 'Mantenha a calma',
          description: 'Fique calmo e tranquilo. Sua energia influencia a pessoa em crise.',
          tip: 'Fale em tom baixo e pausado.'
        },
        {
          number: 2,
          title: 'Encontre um local calmo',
          description: 'Leve a pessoa para um ambiente mais reservado, longe de multid√µes.',
          warning: 'Evite locais fechados se a pessoa tem claustrofobia.'
        },
        {
          number: 3,
          title: 'Ensine respira√ß√£o',
          description: 'Guie: "Inspire pelo nariz contando at√© 4, segure por 4, expire pela boca contando at√© 6".',
          tip: 'Respire junto com a pessoa para dar exemplo.'
        },
        {
          number: 4,
          title: 'Use t√©cnica de aterramento',
          description: 'Pe√ßa para nomear: 5 coisas que v√™, 4 que pode tocar, 3 que escuta, 2 que cheira, 1 que sente o gosto.',
          tip: 'Isso ajuda a pessoa a voltar ao momento presente.'
        }
      ],
      finalTip: 'üí° Importante: Se os sintomas persistirem ou piorarem, procure ajuda m√©dica!'
    },
    'corte-ferimento': {
      title: 'Cortes e Ferimentos',
      emoji: 'ü©π',
      urgency: 'medium',
      description: 'Primeiros cuidados com feridas e sangramento',
      steps: [
        {
          number: 1,
          title: 'Lave as m√£os',
          description: 'Antes de tudo, lave bem as m√£os com √°gua e sab√£o ou use √°lcool gel.',
          warning: 'Nunca toque feridas com m√£os sujas!'
        },
        {
          number: 2,
          title: 'Pare o sangramento',
          description: 'Fa√ßa press√£o direta sobre o ferimento com um pano limpo ou gaze.',
          tip: 'Se o sangue atravessar, coloque mais pano por cima, n√£o retire o primeiro.'
        },
        {
          number: 3,
          title: 'Limpe o ferimento',
          description: 'Com √°gua limpa ou soro fisiol√≥gico, limpe suavemente ao redor da ferida.',
          warning: 'N√£o use √°lcool, √°gua oxigenada ou iodo diretamente na ferida!'
        },
        {
          number: 4,
          title: 'Cubra a ferida',
          description: 'Use gaze est√©ril ou curativo limpo para cobrir o ferimento.',
          tip: 'Troque o curativo se ficar muito sujo ou molhado.'
        }
      ],
      finalTip: 'üí° Procure ajuda m√©dica se: o corte for muito profundo, n√£o parar de sangrar ou houver sinais de infec√ß√£o!'
    },
    'queimadura': {
      title: 'Queimaduras',
      emoji: 'üî•',
      urgency: 'medium',
      description: 'Como tratar queimaduras de diferentes graus',
      steps: [
        {
          number: 1,
          title: 'Remova do perigo',
          description: 'Tire a pessoa da fonte de calor imediatamente.',
          warning: 'Se a roupa grudou na pele, N√ÉO tente tirar!'
        },
        {
          number: 2,
          title: 'Resfrie com √°gua',
          description: 'Coloque √°gua fria (n√£o gelada) sobre a queimadura por 10-15 minutos.',
          tip: 'A √°gua deve estar em temperatura ambiente, n√£o use gelo!'
        },
        {
          number: 3,
          title: 'Cubra com pano limpo',
          description: 'Use um pano limpo e √∫mido para cobrir a √°rea queimada.',
          warning: 'NUNCA use pasta de dente, manteiga ou √≥leo!'
        },
        {
          number: 4,
          title: 'Procure ajuda m√©dica',
          description: 'Para queimaduras grandes ou muito dolorosas, v√° ao hospital.',
          tip: 'Beba bastante √°gua para manter-se hidratado.'
        }
      ],
      finalTip: 'üí° Queimaduras de 2¬∫ e 3¬∫ grau sempre precisam de atendimento m√©dico urgente!'
    },
    'queda-fratura': {
      title: 'Quedas e Fraturas',
      emoji: 'ü¶¥',
      urgency: 'medium',
      description: 'O que fazer em caso de quedas e poss√≠veis fraturas',
      steps: [
        {
          number: 1,
          title: 'N√£o mova a pessoa',
          description: 'Se suspeitar de fratura, n√£o tente mover a pessoa do lugar.',
          warning: 'Movimento pode piorar a les√£o!'
        },
        {
          number: 2,
          title: 'Chame ajuda',
          description: 'Ligue para o SAMU (192) ou bombeiros (193) imediatamente.',
          tip: 'Anote o que aconteceu para informar aos socorristas.'
        },
        {
          number: 3,
          title: 'Imobilize se necess√°rio',
          description: 'Se precisar mover, use talas improvisadas (jornal, madeira) para imobilizar.',
          warning: 'S√≥ fa√ßa isso se houver risco maior em deixar a pessoa no local!'
        },
        {
          number: 4,
          title: 'Monitore sinais vitais',
          description: 'Verifique se a pessoa est√° consciente e respirando normalmente.',
          tip: 'Mantenha a pessoa aquecida e calma.'
        }
      ],
      finalTip: 'üí° Dica: Suspeite de fratura se houver dor intensa, incha√ßo, deformidade ou incapacidade de movimentar!'
    },
    'intoxicacao': {
      title: 'Intoxica√ß√£o',
      emoji: '‚ò†Ô∏è',
      urgency: 'high',
      description: 'Primeiros socorros em casos de intoxica√ß√£o ou envenenamento',
      steps: [
        {
          number: 1,
          title: 'Identifique a subst√¢ncia',
          description: 'Tente descobrir o que a pessoa ingeriu, inalou ou tocou.',
          tip: 'Guarde a embalagem do produto para mostrar aos m√©dicos.'
        },
        {
          number: 2,
          title: 'Ligue para emerg√™ncia',
          description: 'Chame imediatamente o SAMU (192) ou Centro de Intoxica√ß√µes.',
          warning: 'NUNCA provoque v√¥mito sem orienta√ß√£o m√©dica!'
        },
        {
          number: 3,
          title: 'Remova da exposi√ß√£o',
          description: 'Se for inala√ß√£o, leve para local arejado. Se for na pele, lave com √°gua abundante.',
          tip: 'Use luvas ou pano para n√£o se contaminar tamb√©m.'
        },
        {
          number: 4,
          title: 'Monitore a pessoa',
          description: 'Verifique consci√™ncia, respira√ß√£o e mantenha a pessoa acordada se poss√≠vel.',
          warning: 'Se desmaiar, coloque em posi√ß√£o lateral de seguran√ßa.'
        }
      ],
      finalTip: 'üí° Centro de Informa√ß√£o Toxicol√≥gica: 0800 722 6001 - dispon√≠vel 24h!'
    },
    'crise-epileptica': {
      title: 'Crise Epil√©ptica',
      emoji: '‚ö°',
      urgency: 'high',
      description: 'Como ajudar algu√©m durante uma convuls√£o',
      steps: [
        {
          number: 1,
          title: 'Mantenha a calma',
          description: 'N√£o entre em p√¢nico. A crise geralmente dura poucos minutos.',
          warning: 'NUNCA tente segurar ou impedir os movimentos!'
        },
        {
          number: 2,
          title: 'Proteja a pessoa',
          description: 'Retire objetos perigosos ao redor e coloque algo macio embaixo da cabe√ßa.',
          tip: 'Use sua jaqueta ou almofada para proteger a cabe√ßa.'
        },
        {
          number: 3,
          title: 'Posicione de lado',
          description: 'Quando a convuls√£o parar, vire a pessoa de lado para evitar engasgo.',
          warning: 'NUNCA coloque nada na boca da pessoa!'
        },
        {
          number: 4,
          title: 'Cronometr e observe',
          description: 'Anote quanto tempo durou e o que aconteceu para informar aos m√©dicos.',
          tip: 'Fique com a pessoa at√© ela ficar totalmente consciente.'
        }
      ],
      finalTip: 'üí° Chame emerg√™ncia se: a crise durar mais de 5 minutos, pessoa se machucar ou n√£o recuperar consci√™ncia!'
    }
  };

  const currentEmergency = situation ? emergencyData[situation] : null;

  const readAloud = () => {
    if (!currentEmergency) return;
    
    setIsReading(true);
    const text = `${currentEmergency.title}. ${currentEmergency.description}. ${currentEmergency.steps.map(step => `Passo ${step.number}: ${step.title}. ${step.description}`).join(' ')}. ${currentEmergency.finalTip}`;
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'pt-BR';
    utterance.rate = 0.9;
    utterance.onend = () => setIsReading(false);
    
    speechSynthesis.speak(utterance);
  };

  if (!currentEmergency) {
    return (
      <Layout>
        <div className="container mx-auto px-4 py-8">
          <div className="text-center">
            <h1 className="text-3xl font-bold text-emergency mb-4">üòÖ Ops! Situa√ß√£o n√£o encontrada</h1>
            <p className="text-gray-600 mb-6">N√£o encontramos informa√ß√µes sobre essa emerg√™ncia.</p>
            <Link to="/primeiros-socorros" className="trust-button">
              üöë Voltar para Primeiros Socorros
            </Link>
          </div>
        </div>
      </Layout>
    );
  }

  const getUrgencyColor = (urgency: string) => {
    switch(urgency) {
      case 'high': return 'border-emergency-500 bg-emergency-50';
      case 'medium': return 'border-orange-400 bg-orange-50';
      case 'low': return 'border-success-500 bg-success-50';
      default: return 'border-gray-200 bg-gray-50';
    }
  };

  return (
    <Layout>
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        {/* Header */}
        <div className="flex items-center justify-between mb-8">
          <Link 
            to="/primeiros-socorros" 
            className="flex items-center space-x-2 text-trust hover:text-trust-600 transition-colors"
          >
            <ArrowLeft size={20} />
            <span>Voltar</span>
          </Link>
          
          <button 
            onClick={readAloud}
            disabled={isReading}
            className="flex items-center space-x-2 bg-trust text-white px-4 py-2 rounded-xl hover:bg-trust-600 disabled:opacity-50 transition-colors"
          >
            <Volume2 size={20} />
            <span>{isReading ? 'Lendo...' : 'Ouvir guia'}</span>
          </button>
        </div>

        {/* Title Section */}
        <div className={`border-2 rounded-2xl p-6 mb-8 ${getUrgencyColor(currentEmergency.urgency)}`}>
          <div className="text-center">
            <div className="text-6xl mb-4">{currentEmergency.emoji}</div>
            <h1 className="text-4xl font-bold text-gray-800 mb-3">
              {currentEmergency.title}
            </h1>
            <p className="text-xl text-gray-600">
              {currentEmergency.description}
            </p>
          </div>
        </div>

        {/* Steps */}
        <div className="space-y-6 mb-8">
          {currentEmergency.steps.map((step, index) => (
            <div key={index} className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-trust">
              <div className="flex items-start space-x-4">
                <div className="bg-trust text-white rounded-full w-10 h-10 flex items-center justify-center font-bold text-lg flex-shrink-0">
                  {step.number}
                </div>
                <div className="flex-1">
                  <h3 className="text-xl font-bold text-gray-800 mb-2">
                    {step.title}
                  </h3>
                  <p className="text-gray-600 mb-4 leading-relaxed">
                    {step.description}
                  </p>
                  
                  {step.warning && (
                    <div className="bg-emergency-50 border border-emergency-200 rounded-xl p-3 mb-3">
                      <div className="flex items-start space-x-2">
                        <AlertTriangle className="text-emergency mt-0.5 flex-shrink-0" size={18} />
                        <p className="text-emergency-700 font-medium">
                          {step.warning}
                        </p>
                      </div>
                    </div>
                  )}
                  
                  {step.tip && (
                    <div className="bg-success-50 border border-success-200 rounded-xl p-3">
                      <div className="flex items-start space-x-2">
                        <CheckCircle className="text-success mt-0.5 flex-shrink-0" size={18} />
                        <p className="text-success-700 font-medium">
                          {step.tip}
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* Final Tip */}
        <div className="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 text-center">
          <Heart className="text-blue-600 mx-auto mb-3" size={32} />
          <p className="text-blue-800 font-medium text-lg">
            {currentEmergency.finalTip}
          </p>
        </div>

        {/* Emergency Contacts */}
        <div className="bg-emergency-50 border-2 border-emergency rounded-2xl p-6 mt-8">
          <h3 className="text-2xl font-bold text-emergency mb-4 text-center">
            üìû Contatos de Emerg√™ncia
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
            <div className="bg-white p-4 rounded-xl">
              <div className="text-2xl mb-2">üöë</div>
              <div className="font-bold text-emergency">SAMU</div>
              <div className="text-2xl font-bold">192</div>
            </div>
            <div className="bg-white p-4 rounded-xl">
              <div className="text-2xl mb-2">üöí</div>
              <div className="font-bold text-emergency">Bombeiros</div>
              <div className="text-2xl font-bold">193</div>
            </div>
            <div className="bg-white p-4 rounded-xl">
              <div className="text-2xl mb-2">üëÆ</div>
              <div className="font-bold text-emergency">Pol√≠cia</div>
              <div className="text-2xl font-bold">190</div>
            </div>
          </div>
        </div>
      </div>
    </Layout>
  );
};

export default EmergencyGuide;
